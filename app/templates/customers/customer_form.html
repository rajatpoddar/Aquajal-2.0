{% extends "base.html" %}

{% block content %}
    <h2>{{ title }}</h2>
    <div class="card shadow-sm">
        <div class="card-body">
            <form action="" method="post" novalidate>
                {{ form.hidden_tag() }}
                
                <h5 class="mb-3 border-bottom pb-2">Core Details</h5>
                
                {# Customer Name and Mobile #}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        {{ form.name.label(class="form-label") }}<span class="text-danger">*</span>
                        {{ form.name(class="form-control" + (" is-invalid" if form.name.errors else ""), id="name") }}
                        {% for error in form.name.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                    </div>
                    <div class="col-md-6 mb-3">
                        {{ form.mobile_number.label(class="form-label") }}<span class="text-danger">*</span>
                        {{ form.mobile_number(class="form-control" + (" is-invalid" if form.mobile_number.errors else "")) }}
                        {% for error in form.mobile_number.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                        <div class="form-text">This will be used for login and notifications.</div>
                    </div>
                </div>

                {# Type Dropdown #}
                <div class="mb-3">
                    {{ form.customer_type.label(class="form-label") }}<span class="text-danger">*</span>
                    {{ form.customer_type(class="form-select" + (" is-invalid" if form.customer_type.errors else "")) }}
                    {% for error in form.customer_type.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                </div>

                <h5 class="mt-4 mb-3 border-bottom pb-2">Delivery Address</h5>

                {# Address Fields - New Simplified Layout #}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        {{ form.house_number.label(class="form-label") }}
                        {{ form.house_number(class="form-control" + (" is-invalid" if form.house_number.errors else ""), placeholder="e.g., House #123, Flat 2B") }}
                        {% for error in form.house_number.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                    </div>
                    <div class="col-md-6 mb-3">
                         {# Removed the <span class="text-danger">*</span> from here #}
                         {{ form.area.label(class="form-label") }}
                        {{ form.area(class="form-control" + (" is-invalid" if form.area.errors else ""), placeholder="e.g., Gandhi Nagar, Sector 4") }}
                         {% for error in form.area.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                    </div>
                </div>

                <div class="mb-3">
                    {{ form.landmark.label(class="form-label") }}
                    {{ form.landmark(class="form-control" + (" is-invalid" if form.landmark.errors else ""), placeholder="e.g., Near City Hospital") }}
                    {% for error in form.landmark.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                </div>

                <div class="mb-3">
                    {{ form.village.label(class="form-label") }}<span class="text-danger">*</span>
                    {# Add list attribute pointing to the datalist id #}
                    {{ form.village(class="form-control" + (" is-invalid" if form.village.errors else ""), list="village-suggestions", placeholder="e.g., Mumbai, Deoghar") }}
                    {% for error in form.village.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                    {# Datalist for suggestions #}
                    <datalist id="village-suggestions">
                        {% for name in village_names %}
                            <option value="{{ name }}">
                        {% endfor %}
                    </datalist>
                </div>

                <h5 class="mt-4 mb-3 border-bottom pb-2">Service & Account Details</h5>

                {# Jar Details #}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        {{ form.daily_jars.label(class="form-label") }}<span class="text-danger">*</span>
                        {{ form.daily_jars(class="form-control" + (" is-invalid" if form.daily_jars.errors else "")) }}
                        {% for error in form.daily_jars.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                    </div>
                    <div class="col-md-6 mb-3">
                        {{ form.price_per_jar.label(class="form-label") }}<span class="text-danger">*</span>
                        {{ form.price_per_jar(class="form-control" + (" is-invalid" if form.price_per_jar.errors else "")) }}
                        {% for error in form.price_per_jar.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                    </div>
                </div>
                
                {# Email and Password #}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        {{ form.email.label(class="form-label") }}
                        {{ form.email(class="form-control" + (" is-invalid" if form.email.errors else ""), placeholder="Optional - for receipts") }}
                        {% for error in form.email.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                    </div>
                    <div class="col-md-6 mb-3">
                        {{ form.password.label(class="form-label") }}
                        {{ form.password(class="form-control" + (" is-invalid" if form.password.errors else ""), placeholder="Default: 123456 (if blank)") }}
                        {% for error in form.password.errors %}<div class="invalid-feedback">{{ error }}</div>{% endfor %}
                    </div>
                </div>

                {# Note #}
                <div class="mb-3">
                    {{ form.note.label(class="form-label") }}
                    {{ form.note(class="form-control", rows=3, placeholder="Any special instructions or notes...") }}
                </div>

                {# Submit Buttons #}
                <div>
                    {{ form.submit(class="btn btn-primary") }}
                    <a href="{{ url_for('customers.index') }}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
    
{# All JavaScript related to username checking has been removed #}
{% endblock %}